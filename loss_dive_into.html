<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimind Study - Loss Visualization</title>
    
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <script crossorigin src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    
    <script crossorigin src="https://unpkg.com/recharts@2.12.7/umd/Recharts.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* ç®€å•çš„ Loading é®ç½©ï¼Œé˜²æ­¢ React åŠ è½½å‰çš„é—ªçƒ */
        #root:empty::before {
            content: 'Loading visualization...';
            display: block;
            padding: 20px;
            color: #64748b;
            font-family: sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- Google Engineer Check: Environment Safety ---
        if (!window.React || !window.Recharts) {
            console.error("Critical Dependency Error: Libraries failed to load.");
            document.getElementById('root').innerHTML = '<div class="text-red-500 p-4">é”™è¯¯ï¼šä¾èµ–åº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–æ§åˆ¶å°æ—¥å¿—ã€‚</div>';
            throw new Error("Dependency missing");
        }

        // --- è§£æ„å…¨å±€å˜é‡ ---
        const { useState } = React;
        // ä¿®æ­£ï¼šä»å…¨å±€ Recharts å¯¹è±¡ä¸­è·å–ç»„ä»¶
        const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell } = Recharts;

        // --- ä¸»ç»„ä»¶ ---
        const App = () => {
            const [logits, setLogits] = useState([2.1, 1.2, 3.5, 0.8, 1.9]);
            const [labelIndex, setLabelIndex] = useState(2);
            const vocabulary = ["the", "a", "cat", "dog", "sat"];

            const sumExp = logits.reduce((acc, val) => acc + Math.exp(val), 0);
            const logSumExp = Math.log(sumExp);
            const targetLogit = logits[labelIndex];
            const loss = logSumExp - targetLogit;

            const updateLogit = (idx, val) => {
                const newLogits = [...logits];
                newLogits[idx] = parseFloat(val);
                setLogits(newLogits);
            };

            const chartData = logits.map((val, idx) => ({
                name: vocabulary[idx],
                value: val,
                isTarget: idx === labelIndex
            }));

            return (
                <div className="flex flex-col min-h-screen bg-slate-50 p-6 font-sans">
                    <div className="max-w-5xl mx-auto w-full grid grid-cols-1 lg:grid-cols-2 gap-8">
                        
                        {/* Left Panel */}
                        <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                            <h2 className="text-lg font-bold mb-6 flex items-center gap-2">
                                <span className="bg-blue-500 text-white px-2 py-0.5 rounded text-sm">#</span> 
                                Step 1: ç´¢å¼•æå– (Indexing)
                            </h2>

                            <div className="space-y-3">
                                {logits.map((val, idx) => (
                                    <div 
                                        key={idx} 
                                        onClick={() => setLabelIndex(idx)}
                                        className={`flex items-center gap-4 p-3 rounded-lg border-2 transition-all cursor-pointer ${
                                            idx === labelIndex ? 'border-emerald-500 bg-emerald-50' : 'border-slate-100 hover:border-slate-200'
                                        }`}
                                    >
                                        <span className="w-8 font-mono text-slate-400">[{idx}]</span>
                                        <span className="w-12 font-bold">{vocabulary[idx]}</span>
                                        <input 
                                            type="range" min="-2" max="5" step="0.1" 
                                            value={val} 
                                            onChange={(e) => updateLogit(idx, e.target.value)}
                                            className="flex-1 h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer"
                                            onClick={(e) => e.stopPropagation()} 
                                        />
                                        <span className="w-10 font-mono font-bold text-right">{val.toFixed(1)}</span>
                                        {idx === labelIndex && <span>ğŸ¯</span>}
                                    </div>
                                ))}
                            </div>

                            <div className="mt-8 p-4 bg-slate-900 rounded-xl font-mono text-sm">
                                <div className="text-slate-500"># æ­£ç¡®ç­”æ¡ˆ labels[i+1] = {labelIndex}</div>
                                <div className="text-emerald-400">target_logit = {targetLogit.toFixed(2)}</div>
                            </div>
                        </div>

                        {/* Right Panel */}
                        <div className="flex flex-col gap-6">
                            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                                <h2 className="text-lg font-bold mb-6 flex items-center gap-2">
                                    <span className="bg-purple-500 text-white px-2 py-0.5 rounded text-sm">></span>
                                    Step 2: å…¬å¼æ˜ å°„
                                </h2>
                                
                                <div className="space-y-6">
                                    <div className="flex justify-between items-end text-center">
                                        <div className="flex-1">
                                            <div className="text-xl font-mono font-bold text-blue-600">{logSumExp.toFixed(3)}</div>
                                            <div className="text-[10px] text-slate-400 uppercase mt-1">LogSumExp</div>
                                        </div>
                                        <div className="text-2xl text-slate-300 pb-2">âˆ’</div>
                                        <div className="flex-1">
                                            <div className="text-xl font-mono font-bold text-emerald-600">{targetLogit.toFixed(3)}</div>
                                            <div className="text-[10px] text-slate-400 uppercase mt-1">Target Logit</div>
                                        </div>
                                        <div className="text-2xl text-slate-300 pb-2">=</div>
                                        <div className="flex-1">
                                            <div className="text-2xl font-mono font-bold text-red-500">{loss.toFixed(3)}</div>
                                            <div className="text-[10px] text-slate-400 font-bold uppercase mt-1 text-red-400">Loss</div>
                                        </div>
                                    </div>

                                    <div className="h-48 w-full">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <BarChart data={chartData}>
                                                <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                                                <XAxis dataKey="name" axisLine={false} tickLine={false} />
                                                <YAxis hide domain={[0, 6]} />
                                                <Tooltip cursor={{fill: 'transparent'}} />
                                                <Bar dataKey="value" radius={[4, 4, 0, 0]}>
                                                    {chartData.map((entry, index) => (
                                                        <Cell key={`cell-${index}`} fill={entry.isTarget ? '#10b981' : '#cbd5e1'} />
                                                    ))}
                                                </Bar>
                                            </BarChart>
                                        </ResponsiveContainer>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-blue-50 border border-blue-100 p-5 rounded-2xl">
                                <p className="text-xs text-blue-700 leading-relaxed">
                                    <b>åŸç†ï¼š</b> CrossEntropy çš„æœ¬è´¨æ˜¯è®©æ¨¡å‹åœ¨æ‰€æœ‰é€‰é¡¹ä¸­æ„Ÿåˆ°â€œå‹åŠ›â€æœ€å°åŒ–çš„åŒæ—¶ï¼Œæœ€å¤§åŒ–æ­£ç¡®é¡¹çš„å¾—åˆ†ã€‚
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
